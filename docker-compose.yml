version: '3.8'

services:
  # 仅保留后端服务，所有请求走5000端口
  backend:
    build: ./backend
    ports:
      - "5000:5000"  # 唯一端口：5000
    volumes:
      - ./backend:/app                # 代码热更新
      - ./backend/config:/app/config  # 配置持久化
      - ./backend/output:/app/output  # 节目单持久化
    environment:
      - PORT=5000
      - UPDATE_INTERVAL=21600
      - FFPROBE_CONCURRENCY=8
    restart: always
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G
